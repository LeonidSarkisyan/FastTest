<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/../static/css/main.css">
    <link rel="icon" href="/../static/img/logo.png">
    <link rel="stylesheet" href="/../static/css/one_test.css">
    <link rel="stylesheet" href="/../static/css/modal.css">
    <script src="https://cdn.jsdelivr.net/gh/ryangjchandler/spruce@0.6.0/dist/spruce.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <title>{{ .title }}</title>
</head>
<body>
<embed src="/p/header" width="100%" height="100"/>
<div class="container" x-data x-subscribe>
    <h1 class="title title__span" x-text="$store.data.title"></h1>
    <span class="sub__title" @click="$store.methods.showModal()">
            изменить название
        </span>
    <div id="myModal" class="modal" x-show="$store.data.showModal">
        <div class="modal-content">
            <div class="tests__form">
                <div class="tests__form__title">Изменить название</div>
                <div class="tests__form__body">
                    <label for="test__title" class="test__title__label">Название теста:</label>
                    <input
                            @keydown.enter="$store.methods.UpdateTitleTest()"
                            placeholder="Например, Windows формы"
                            type="text"
                            id="test__title"
                            class="base__input create"
                            x-model="$store.data.mainTitle"
                    >
                    <div class="base__button" @click="$store.methods.UpdateTitleTest()">
                        Изменить название
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="myModalChat" class="modal" x-show="$store.data.showModalChat">
        <div class="modal-content">
            <div class="tests__form">
                <div class="tests__form__title chat__color chat__title">Добавить вопросы с помощью ChatGPT</div>
                <div class="tests__form__body">
                    <label for="chat" class="test__title__label chat__color">Тема теста:</label>
                    <input
                            id="chat"
                            @keydown.enter="$store.methods.UpdateTitleTest()"
                            placeholder="Например, Численные методы"
                            type="text"
                            class="base__input create chat__color chat__border"
                            x-model="$store.data.titleTheme"
                    >
                    <label for="chat__count" class="test__title__label chat__color">Количество вопросов:</label>
                    <select
                            x-model="$store.data.countQuestion"
                            id="chat__count"
                            class="base__input count__questions chat__color chat__border"
                    >
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5" selected>5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                    </select>
                    <div
                            x-show="!$store.data.loading"
                            class="note"
                    >
                        ChatGPT может ошибаться, после генерации проверьте созданные им вопросы <br>
                        Генерация может занимать до 1 минуты
                    </div>
                    <div
                            x-show="!$store.data.loading"
                            class="base__button chat__color chat__border chat__button"
                            @click="$store.methods.CreateQuestionsFromChatGPT()"
                    >
                        Сгенерировать вопросы
                    </div>
                    <div class="loading" x-show="$store.data.loading">
                        <div class="loader loader__chat__gpt">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="question__form list">
        <template x-for="(question, index) in $store.data.questions" :key="question.id">
            <div
                    @contextmenu.prevent="$store.methods.deleteQuestion(index, question.id)"
                    :title="question.text"
                    @click="$store.methods.chooseIndex(index)"
                    :class="{ 'question__list__point__active': $store.data.currentIndex === index }"
                    class="question__list__point"
                    x-text="index + 1"
            >
            </div>
        </template>
        <div class="question__list__point plus" @click="$store.methods.addQuestion()">
            +
        </div>
        <div class="question__list__point plus chat__gpt__button" @click="$store.methods.showChatModal()">
            <img src="/../static/img/chatgpt.png" alt="Открыть нейросеть" class="chat__gpt__icon">
        </div>
    </div>
    <template x-if="$store.data.questions.length">
        <div>
            <div class="question__form">
                <div class="question__form__title">Текст вопроса:</div>
                <input
                        @keydown.enter="$store.methods.focusAnswer(-1)"
                        @change="$store.methods.updateTextQuestion()"
                        id="input"
                        class="base__input text"
                        x-model="$store.data.questions[$store.data.currentIndex].text"
                >
            </div>
            <div class="question__form" id="answer__list">
                <div class="question__form__title">Варианты ответов:</div>
                <template
                        :key="answer.id"
                        x-for="(answer, index) in $store.data.questions[$store.data.currentIndex].answers"
                >
                    <div class="answer__point" :id="'answer_' + answer.id">
                        <input
                                @change="$store.methods.updateAnswer(index)"
                                class="answer__point__checkbox"
                                type="checkbox"
                                x-model="answer.is_correct"
                        >
                        <input
                                @keydown.enter="$store.methods.focusAnswer(index, $event)"
                                @change="$store.methods.updateAnswer(index)"
                                class="base__input text answer__input"
                                x-model="answer.text"
                        >
                        <div
                                @click="$store.methods.deleteAnswer(answer.id)"
                                class="answer__point__delete"
                                :class="{ 'answer__point__delete__disable': $store.data.questions[$store.data.currentIndex].answers.length < 3}"
                        >
                            &#10006;
                        </div>
                    </div>
                </template>
                <div class="base__button" @click="$store.methods.addAnswer()">
                    Добавить вариант ответа
                </div>
            </div>
        </div>
    </template>
</div>
<script type="module" src="/../static/js/one_test.js">

</script>
</body>
</html>